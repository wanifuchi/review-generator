# 🎋 とね屋口コミ生成システム - 完全セットアップマニュアル

## 📋 システム概要

**とね屋口コミ生成システム**は、ユーザーが星評価とタグを選択し、AI生成された口コミを投稿ボタン1つで`info@toneya.co.jp`に自動送信するPHPシステムです。

### ✨ 主要機能
- ⭐ 星評価選択（1-5つ星）
- 🏷️ サービスタグ選択
- 🤖 AI口コミ自動生成
- 📧 ワンクリックメール送信
- 🎨 美しいサンクスページ
- 📱 Google口コミ誘導

---

## 🎯 完全ファイル構成

```
toneya-review-system/
├── 📄 index.php              # メインページ（フォーム + PHP処理）
├── 📄 thanks.php             # サンクスページ
├── 🎨 styles.css             # メインページスタイル
├── 🎨 thanks-styles.css      # サンクスページスタイル
├── 🖼️ logo.png               # ロゴ画像
├── ⚙️ config.php             # 設定ファイル
├── 📧 send_email.php         # 旧メール送信（予備）
├── 📦 composer.json          # PHP依存関係
├── 🛡️ .htaccess              # セキュリティ設定
└── 📚 SETUP_MANUAL.md        # このファイル
```

---

## 🚀 STEP 1: 事前準備

### 1.1 Gmail アプリパスワード取得

1. **Googleアカウント**にログイン
2. **アカウント管理** → **セキュリティ**
3. **2段階認証**を有効にする
4. **アプリパスワード**を生成
   - アプリ: 「メール」を選択
   - デバイス: 「その他（カスタム名）」→「とね屋口コミシステム」
   - **16桁のパスワード**をメモ保存

### 1.2 ホスティングサービス選択

#### 🏆 推奨ホスティング
| サービス | 月額料金 | PHP対応 | おすすめ度 |
|----------|----------|---------|------------|
| **エックスサーバー** | 990円〜 | ✅ PHP8.1 | ⭐⭐⭐⭐⭐ |
| **さくらレンタルサーバー** | 425円〜 | ✅ PHP8.0 | ⭐⭐⭐⭐ |
| **ConoHa WING** | 828円〜 | ✅ PHP8.1 | ⭐⭐⭐⭐ |
| **ロリポップ** | 550円〜 | ✅ PHP7.4 | ⭐⭐⭐ |

---

## ⚙️ STEP 2: 設定ファイル編集

### 2.1 config.php の編集

`config.php`ファイルを開き、以下の部分を**実際の値**に変更：

```php
// ⚠️ 必須変更箇所
define('MAIL_USERNAME', 'your-email@gmail.com');     // 👈 実際のGmailアドレス
define('MAIL_PASSWORD', 'your-16-digit-app-password'); // 👈 取得したアプリパスワード
define('MAIL_FROM_EMAIL', 'your-email@gmail.com');   // 👈 送信者アドレス
```

#### 📝 設定例
```php
define('MAIL_USERNAME', 'toneya.system@gmail.com');
define('MAIL_PASSWORD', 'abcd efgh ijkl mnop');  // スペースは自動で除去されます
define('MAIL_FROM_EMAIL', 'toneya.system@gmail.com');
```

### 2.2 受信者確認

以下の設定が正しいかチェック：
```php
define('MAIL_TO_EMAIL', 'info@toneya.co.jp'); // ✅ 受信者アドレス
```

---

## 📁 STEP 3: ファイルアップロード

### 3.1 アップロード方法

#### Method A: FTPソフト使用
1. **FileZilla**等のFTPソフトを起動
2. ホスティングサービスのFTP情報を入力
3. 全ファイルを**ドキュメントルート**にアップロード

#### Method B: ファイルマネージャー使用
1. ホスティングサービスの**コントロールパネル**にログイン
2. **ファイルマネージャー**を開く
3. **public_html**フォルダに全ファイルをアップロード

### 3.2 PHPMailer インストール

#### Option A: Composer使用（推奨）
```bash
# サーバーのターミナルで実行
composer install
```

#### Option B: 手動インストール
1. [PHPMailer GitHub](https://github.com/PHPMailer/PHPMailer/releases)からダウンロード
2. `PHPMailer`フォルダを作成し、以下を配置：
```
PHPMailer/
├── src/
│   ├── PHPMailer.php
│   ├── SMTP.php
│   └── Exception.php
└── ...
```

---

## 🔧 STEP 4: 動作テスト

### 4.1 アクセステスト

1. ブラウザで**システムURL**にアクセス
```
https://yourdomain.com/index.php
```

2. ページが正常に表示されることを確認

### 4.2 メール送信テスト

1. **星評価**を選択（例：5つ星）
2. **タグ**を選択（例：「スタッフの対応」）
3. **「AI口コミ生成」**をクリック
4. 生成された口コミを確認
5. **「口コミを投稿」**をクリック
6. **Thanks ページ**に遷移することを確認
7. **`info@toneya.co.jp`**にメールが届くことを確認

### 4.3 エラー確認方法

#### ブラウザでのエラー確認
1. **F12**キーで開発者ツールを開く
2. **Console**タブでエラーログを確認

#### サーバーエラーログ確認
```bash
# サーバーのエラーログファイルを確認
tail -f /path/to/error.log
```

---

## 🎨 STEP 5: カスタマイズ

### 5.1 ロゴ変更

`logo.png`を差し替えて、システムのロゴを変更可能

### 5.2 タグのカスタマイズ

`index.php`内の以下部分を編集：
```html
<div class="tag-grid" id="tagGrid">
    <button class="tag-button" data-tag="斎場">斎場</button>
    <button class="tag-button" data-tag="家族葬">家族葬</button>
    <button class="tag-button" data-tag="海洋散骨">海洋散骨</button>
    <button class="tag-button" data-tag="スタッフの対応">スタッフの対応</button>
    <!-- 新しいタグを追加可能 -->
</div>
```

### 5.3 AI生成テンプレート調整

`index.php`内の`realExperiences`オブジェクトを編集して、生成される口コミのパターンを変更可能

---

## 🛡️ STEP 6: セキュリティ設定

### 6.1 ファイル権限設定

```bash
# 推奨権限設定
chmod 644 *.php *.css *.html
chmod 755 index.php thanks.php
chmod 600 config.php  # 設定ファイルは読み取り専用
```

### 6.2 .htaccess 確認

`.htaccess`ファイルが正しくアップロードされ、以下の保護が有効になっていることを確認：

- 設定ファイルへの直接アクセス拒否
- セキュリティヘッダーの設定
- CORS設定

---

## 🔍 STEP 7: トラブルシューティング

### 7.1 メールが送信されない

#### 問題1: 認証エラー
```
解決策：
- Gmailアプリパスワードを再確認
- 2段階認証が有効になっているか確認
- アプリパスワードにスペースが含まれていないか確認
```

#### 問題2: SMTP接続エラー
```
解決策：
- サーバーがport 587（SMTP）を許可しているか確認
- SSL/TLS設定を確認
- ファイアウォール設定を確認
```

### 7.2 PHP エラー

#### 問題1: PHPMailer not found
```
解決策：
- composer install を実行
- PHPMailerの手動インストールを確認
- パスが正しいか確認
```

#### 問題2: 権限エラー
```
解決策：
- ファイル権限を確認
- サーバーのPHPバージョンを確認（7.4以上推奨）
```

### 7.3 Google口コミ遷移問題

#### 問題: 違う会社に遷移する
```
解決策：
- thanks.php の googleUrl を確認
- 「株式会社とね屋」での検索結果を確認
- 必要に応じてより具体的な検索語句に変更
```

---

## 📞 STEP 8: 運用開始

### 8.1 最終チェックリスト

- [ ] **メール送信**テスト完了
- [ ] **Thanks ページ**遷移確認
- [ ] **Google口コミ**誘導確認
- [ ] **レスポンシブ**デザイン確認
- [ ] **エラーログ**に問題なし
- [ ] **SSL証明書**が有効

### 8.2 定期メンテナンス

#### 月次チェック
- エラーログの確認
- メール送信状況の確認
- サーバーディスク容量の確認

#### 年次チェック
- PHP/PHPMailerのアップデート
- SSL証明書の更新
- バックアップの取得

---

## 📧 STEP 9: メール受信時の対応

### 9.1 メール形式

送信されるメールは以下の形式：

```
件名: 新しい口コミ投稿 - 5★

内容:
🎋 新しい口コミが投稿されました

⭐ 評価: 5つ星
🏷️ タグ: スタッフの対応

💬 口コミ内容:
[生成または入力された口コミテキスト]

送信日時: 2024年XX月XX日 XX:XX:XX
```

### 9.2 活用方法

1. **受信メール**を確認
2. **Google マイビジネス**で実際の口コミをチェック
3. 必要に応じて**お客様への返信**を検討
4. **サービス改善**の参考にする

---

## 🎉 完了！

これで**とね屋口コミ生成システム**の完全セットアップが完了しました！

### 🔗 システムURL
```
メインページ: https://yourdomain.com/index.php
サンクスページ: https://yourdomain.com/thanks.php
```

### 🎯 期待される結果
- ユーザーが簡単に口コミを生成・投稿
- 自動的に`info@toneya.co.jp`にメール送信
- Google口コミへの誘導でオンライン評価向上

---

**🎋 とね屋口コミ生成システム v2.0 PHP完全版**  
*お疲れ様でした！*